# çŠ¶æ€æå‡æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ

çŠ¶æ€æå‡ï¼ˆState Hoistingï¼‰æ˜¯ Jetpack Compose ä¸­çš„ä¸€ä¸ªé‡è¦æ¨¡å¼ï¼Œå®ƒæŒ‡çš„æ˜¯**å°†çŠ¶æ€ä»å¯ç»„åˆå‡½æ•°ä¸­ç§»åŠ¨åˆ°å…¶è°ƒç”¨æ–¹**ï¼Œä½¿ç»„ä»¶å˜ä¸ºæ— çŠ¶æ€çš„ã€‚

## ä»€ä¹ˆæ˜¯çŠ¶æ€æå‡ï¼Ÿ

### åŸºæœ¬æ¦‚å¿µ
çŠ¶æ€æå‡æ„å‘³ç€ï¼š
- å°†çŠ¶æ€**å‘ä¸Šç§»åŠ¨**åˆ°ç»„ä»¶çš„è°ƒç”¨é“¾ä¸­
- ä½¿ç»„ä»¶**ä¸ç®¡ç†è‡ªå·±çš„çŠ¶æ€**
- é€šè¿‡**å‚æ•°**æ¥æ”¶çŠ¶æ€å’Œäº‹ä»¶å›è°ƒ

### ç¤ºä¾‹ï¼šä»æœ‰çŠ¶æ€åˆ°æ— çŠ¶æ€

**æœ‰çŠ¶æ€ç»„ä»¶ï¼ˆä¸æ¨èï¼‰ï¼š**
```kotlin
@Composable
fun StatefulCounter() {
    var count by remember { mutableStateOf(0) } // çŠ¶æ€åœ¨ç»„ä»¶å†…éƒ¨
    
    Button(onClick = { count++ }) {
        Text("Count: $count")
    }
}
```

**æ— çŠ¶æ€ç»„ä»¶ï¼ˆçŠ¶æ€æå‡åï¼‰ï¼š**
```kotlin
// æ— çŠ¶æ€ç»„ä»¶ - é€šè¿‡å‚æ•°æ¥æ”¶çŠ¶æ€å’Œäº‹ä»¶
@Composable
fun StatelessCounter(
    count: Int,                    // çŠ¶æ€é€šè¿‡å‚æ•°ä¼ å…¥
    onIncrement: () -> Unit        // äº‹ä»¶é€šè¿‡å›è°ƒå¤„ç†
) {
    Button(onClick = onIncrement) {
        Text("Count: $count")
    }
}

// çŠ¶æ€åœ¨çˆ¶ç»„ä»¶ä¸­ç®¡ç†
@Composable
fun ParentScreen() {
    var count by remember { mutableStateOf(0) } // çŠ¶æ€æå‡åˆ°è¿™é‡Œ
    
    Column {
        StatelessCounter(
            count = count,
            onIncrement = { count++ }
        )
        // å¯ä»¥é‡ç”¨åŒä¸€ä¸ªçŠ¶æ€
        AnotherComponent(count = count)
    }
}
```

## ä¸ºä»€ä¹ˆçŠ¶æ€æå‡é‡è¦ï¼Ÿ

### 1. **å¯é‡ç”¨æ€§ï¼ˆReusabilityï¼‰**
æ— çŠ¶æ€ç»„ä»¶æ›´å®¹æ˜“åœ¨ä¸åŒåœºæ™¯ä¸‹é‡ç”¨ï¼š

```kotlin
@Composable
fun ToggleSwitch(
    isChecked: Boolean,           // çŠ¶æ€ä»å¤–éƒ¨ä¼ å…¥
    onCheckedChange: (Boolean) -> Unit
) {
    Switch(
        checked = isChecked,
        onCheckedChange = onCheckedChange
    )
}

// åœ¨ä¸åŒåœ°æ–¹é‡ç”¨åŒä¸€ä¸ªç»„ä»¶
@Composable
fun SettingsScreen() {
    var darkMode by remember { mutableStateOf(false) }
    var notifications by remember { mutableStateOf(true) }
    
    Column {
        ToggleSwitch(
            isChecked = darkMode,
            onCheckedChange = { darkMode = it }
        )
        ToggleSwitch(
            isChecked = notifications,
            onCheckedChange = { notifications = it }
        )
    }
}
```

### 2. **å¯æµ‹è¯•æ€§ï¼ˆTestabilityï¼‰**
æ— çŠ¶æ€ç»„ä»¶æ›´å®¹æ˜“æµ‹è¯•ï¼š

```kotlin
// æ˜“äºæµ‹è¯•çš„æ— çŠ¶æ€ç»„ä»¶
@Test
fun testStatelessCounter() {
    var testCount = 0
    var lastIncrementCall: (() -> Unit)? = null
    
    composeTestRule.setContent {
        StatelessCounter(
            count = testCount,
            onIncrement = { lastIncrementCall = { testCount++ } }
        )
    }
    
    // æ¨¡æ‹Ÿç‚¹å‡»
    composeTestRule.onNodeWithText("Count: 0").performClick()
    lastIncrementCall?.invoke()
    
    // éªŒè¯çŠ¶æ€å˜åŒ–
    assert(testCount == 1)
}
```

### 3. **çŠ¶æ€å…±äº«ï¼ˆState Sharingï¼‰**
å¤šä¸ªç»„ä»¶å¯ä»¥è½»æ¾å…±äº«åŒä¸€çŠ¶æ€ï¼š

```kotlin
@Composable
fun ShoppingCart() {
    var itemCount by remember { mutableStateOf(0) }
    
    Column {
        // å¤šä¸ªç»„ä»¶å…±äº«åŒä¸€ä¸ªçŠ¶æ€
        CartHeader(itemCount = itemCount)
        ProductList(
            onAddToCart = { itemCount++ }
        )
        CheckoutButton(itemCount = itemCount)
    }
}

@Composable
fun CartHeader(itemCount: Int) {
    Text("Cart: $itemCount items")
}

@Composable
fun CheckoutButton(itemCount: Int) {
    Button(
        onClick = { /* Checkout */ },
        enabled = itemCount > 0
    ) {
        Text("Checkout ($itemCount)")
    }
}
```

### 4. **å•ä¸€æ•°æ®æºï¼ˆSingle Source of Truthï¼‰**
é¿å…çŠ¶æ€é‡å¤å’Œä¸ä¸€è‡´ï¼š

```kotlin
// âŒ é—®é¢˜ï¼šçŠ¶æ€é‡å¤
@Composable
fun ProblematicScreen() {
    var searchQuery by remember { mutableStateOf("") }
    
    SearchBox(searchQuery) { searchQuery = it }
    SearchResults(searchQuery)
    
    // å¦ä¸€ä¸ªåœ°æ–¹ä¹Ÿç®¡ç†æœç´¢çŠ¶æ€ï¼Ÿå®¹æ˜“ä¸ä¸€è‡´ï¼
}

// âœ… è§£å†³æ–¹æ¡ˆï¼šå•ä¸€æ•°æ®æº
@Composable
fun BetterScreen() {
    var searchQuery by remember { mutableStateOf("") }
    
    Column {
        SearchBox(
            query = searchQuery,
            onQueryChange = { searchQuery = it }
        )
        SearchResults(query = searchQuery)
        SearchHistory(
            currentQuery = searchQuery,
            onQuerySelect = { searchQuery = it } // ç»Ÿä¸€æ›´æ–°
        )
    }
}
```

### 5. **å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰**
UI ç»„ä»¶åªè´Ÿè´£æ˜¾ç¤ºï¼Œä¸šåŠ¡é€»è¾‘åœ¨å¤–éƒ¨å¤„ç†ï¼š

```kotlin
// UI ç»„ä»¶åªå…³å¿ƒæ˜¾ç¤º
@Composable
fun UserProfile(
    user: User?,
    isLoading: Boolean,
    onRetry: () -> Unit,
    onEdit: () -> Unit
) {
    if (isLoading) {
        LoadingIndicator()
    } else if (user != null) {
        Column {
            UserAvatar(user.avatarUrl)
            UserInfo(user.name, user.email)
            Button(onClick = onEdit) {
                Text("Edit Profile")
            }
        }
    } else {
        ErrorMessage(onRetry = onRetry)
    }
}

// ä¸šåŠ¡é€»è¾‘åœ¨ ViewModel ä¸­
class UserViewModel : ViewModel() {
    private val _user = mutableStateOf<User?>(null)
    private val _isLoading = mutableStateOf(false)
    
    val user: User? get() = _user.value
    val isLoading: Boolean get() = _isLoading.value
    
    fun loadUser() { /* ä¸šåŠ¡é€»è¾‘ */ }
    fun editUser() { /* ä¸šåŠ¡é€»è¾‘ */ }
}

// ç»„åˆï¼šUI + ä¸šåŠ¡é€»è¾‘
@Composable
fun UserProfileScreen(viewModel: UserViewModel = hiltViewModel()) {
    UserProfile(
        user = viewModel.user,
        isLoading = viewModel.isLoading,
        onRetry = { viewModel.loadUser() },
        onEdit = { viewModel.editUser() }
    )
}
```

## çŠ¶æ€æå‡çš„æ¨¡å¼

### 1. åŸºç¡€æ¨¡å¼
```kotlin
@Composable
fun <T> StatefulComponent(
    value: T,
    onValueChange: (T) -> Unit
) {
    // ç»„ä»¶å®ç°...
}
```

### 2. å¤šçŠ¶æ€æå‡
```kotlin
@Composable
fun LoginForm(
    email: String,
    onEmailChange: (String) -> Unit,
    password: String,
    onPasswordChange: (String) -> Unit,
    rememberMe: Boolean,
    onRememberMeChange: (Boolean) -> Unit,
    onSubmit: () -> Unit
) {
    Column {
        OutlinedTextField(
            value = email,
            onValueChange = onEmailChange,
            label = { Text("Email") }
        )
        OutlinedTextField(
            value = password,
            onValueChange = onPasswordChange,
            label = { Text("Password") }
        )
        Checkbox(
            checked = rememberMe,
            onCheckedChange = onRememberMeChange
        )
        Button(onClick = onSubmit) {
            Text("Login")
        }
    }
}
```

### 3. çŠ¶æ€å®¹å™¨æ¨¡å¼
```kotlin
// çŠ¶æ€å®¹å™¨
data class FormState(
    val email: String = "",
    val password: String = "",
    val rememberMe: Boolean = false
)

@Composable
fun rememberFormState(): FormState {
    return remember { FormState() }
}

// ä½¿ç”¨çŠ¶æ€å®¹å™¨
@Composable
fun LoginScreen() {
    val formState = rememberFormState()
    
    LoginForm(
        email = formState.email,
        onEmailChange = { formState.email = it },
        password = formState.password,
        onPasswordChange = { formState.password = it },
        rememberMe = formState.rememberMe,
        onRememberMeChange = { formState.rememberMe = it },
        onSubmit = { /* æäº¤é€»è¾‘ */ }
    )
}
```

## ä½•æ—¶ä½¿ç”¨çŠ¶æ€æå‡ï¼Ÿ

### åº”è¯¥æå‡çŠ¶æ€çš„æƒ…å†µï¼š
- âœ… ç»„ä»¶éœ€è¦è¢«å¤šä¸ªçˆ¶ç»„ä»¶é‡ç”¨
- âœ… å¤šä¸ªç»„ä»¶éœ€è¦å…±äº«åŒä¸€çŠ¶æ€
- âœ… éœ€è¦æµ‹è¯•ç»„ä»¶çš„è¡Œä¸º
- âœ… çŠ¶æ€éœ€è¦ä¸ä¸šåŠ¡é€»è¾‘é›†æˆ

### å¯ä»¥ä¿æŒæœ¬åœ°çŠ¶æ€çš„æƒ…å†µï¼š
- âœ… ç®€å•çš„ UI çŠ¶æ€ï¼ˆå¦‚åŠ¨ç”»è¿›åº¦ï¼‰
- âœ… çº¯å±•ç¤ºæ€§ç»„ä»¶
- âœ… ä¸´æ—¶çŠ¶æ€ï¼ˆå¦‚æ–‡æœ¬é€‰æ‹©ï¼‰

## æ€»ç»“

çŠ¶æ€æå‡æ˜¯ Compose ä¸­è‡³å…³é‡è¦çš„æ¨¡å¼ï¼Œå› ä¸ºå®ƒï¼š
- ğŸ¯ **æé«˜å¯é‡ç”¨æ€§** - ç»„ä»¶å¯ä»¥åœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨
- ğŸ§ª **å¢å¼ºå¯æµ‹è¯•æ€§** - æ›´å®¹æ˜“ç¼–å†™å•å…ƒæµ‹è¯•
- ğŸ”„ **ä¿ƒè¿›çŠ¶æ€å…±äº«** - å¤šä¸ªç»„ä»¶å¯ä»¥è®¿é—®åŒä¸€çŠ¶æ€
- ğŸ“Š **ç¡®ä¿æ•°æ®ä¸€è‡´æ€§** - å•ä¸€æ•°æ®æºé¿å…çŠ¶æ€å†²çª
- ğŸ—ï¸ **æ”¹å–„æ¶æ„** - æ¸…æ™°çš„å…³æ³¨ç‚¹åˆ†ç¦»

é€šè¿‡çŠ¶æ€æå‡ï¼Œä½ å¯ä»¥æ„å»ºæ›´åŠ çµæ´»ã€å¯ç»´æŠ¤å’Œå¯æµ‹è¯•çš„ Compose åº”ç”¨ç¨‹åºã€‚