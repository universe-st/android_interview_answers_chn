# 列举几个常见的系统广播（如开机启动、网络变化），并说明如何注册监听？

以下是常见的系统广播及其注册方法，结合Android版本特性和权限要求进行详细说明：

### 一、开机完成广播（`ACTION_BOOT_COMPLETED`）
**用途**：设备启动完成后触发，常用于初始化后台服务或定时任务。  
**注册方式**：  
1. **静态注册**（需权限）：  
   ```xml
   <!-- AndroidManifest.xml -->
   <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
   <receiver android:name=".BootReceiver">
       <intent-filter>
           <action android:name="android.intent.action.BOOT_COMPLETED" />
       </intent-filter>
   </receiver>
   ```  
   **注意**：  
   - Android 8.0+要求应用必须至少启动过一次才能接收此广播。  
   - 若需在广播中启动Activity，需先启动一个**前台服务**，避免后台Activity限制。  

2. **动态注册**（可选）：  
   ```java
   // 在Activity/Service中注册
   IntentFilter filter = new IntentFilter(Intent.ACTION_BOOT_COMPLETED);
   registerReceiver(bootReceiver, filter);
   // 注销时调用 unregisterReceiver(bootReceiver);
   ```  


### 二、网络状态变化广播（`ACTION_CONNECTIVITY_CHANGE`）
**用途**：监听Wi-Fi/移动数据切换、网络连接中断等事件。  
**注册方式**：  
- **动态注册**（Android 7.0+仅支持此方式）：  
  ```java
  IntentFilter filter = new IntentFilter(ConnectivityManager.CONNECTIVITY_ACTION);
  registerReceiver(networkReceiver, filter);
  ```  
  **注意**：  
  - 静态注册在Android 7.0+失效。  
  - 建议结合`ConnectivityManager`主动查询网络状态，避免依赖广播的延迟性。  

- **权限**：需声明`ACCESS_NETWORK_STATE`。  


### 三、电量变化广播（`ACTION_BATTERY_CHANGED`）
**用途**：监听电量百分比、充电状态（如插入/拔出充电器）。  
**注册方式**：  
- **动态注册**（仅支持此方式）：  
  ```java
  IntentFilter filter = new IntentFilter(Intent.ACTION_BATTERY_CHANGED);
  registerReceiver(batteryReceiver, filter);
  ```  
  **数据获取**：  
  - 通过`intent.getIntExtra(BatteryManager.EXTRA_LEVEL, -1)`获取电量百分比。  
  - 通过`intent.getIntExtra(BatteryManager.EXTRA_PLUGGED, -1)`判断充电状态（0=未充电，1=AC充电，2=USB充电）。  


### 四、屏幕状态广播（`ACTION_SCREEN_ON`/`ACTION_SCREEN_OFF`）
**用途**：优化资源使用（如屏幕关闭时暂停动画）。  
**注册方式**：  
- **动态注册**（仅支持此方式）：  
  ```java
  IntentFilter filter = new IntentFilter();
  filter.addAction(Intent.ACTION_SCREEN_ON);
  filter.addAction(Intent.ACTION_SCREEN_OFF);
  registerReceiver(screenReceiver, filter);
  ```  
  **注意**：  
  - 静态注册无效。  
  - 需在`onReceive`中处理屏幕状态变化，避免耗时操作。  


### 五、应用安装/卸载广播（`ACTION_PACKAGE_ADDED`/`ACTION_PACKAGE_REMOVED`）
**用途**：监控设备上应用的安装、卸载或更新事件。  
**注册方式**：  
1. **静态注册**（需权限）：  
   ```xml
   <receiver android:name=".PackageReceiver">
       <intent-filter>
           <action android:name="android.intent.action.PACKAGE_ADDED" />
           <action android:name="android.intent.action.PACKAGE_REMOVED" />
           <data android:scheme="package" /> <!-- 必须添加 -->
       </intent-filter>
   </receiver>
   ```  
   **权限**：  
   - Android 13+需声明`QUERY_ALL_PACKAGES`权限。  
   - 旧版本需`GET_PACKAGE_SIZE`等权限。  

2. **动态注册**（可选）：  
   ```java
   IntentFilter filter = new IntentFilter();
   filter.addAction(Intent.ACTION_PACKAGE_ADDED);
   filter.addAction(Intent.ACTION_PACKAGE_REMOVED);
   filter.addDataScheme("package");
   registerReceiver(packageReceiver, filter);
   ```  


### 六、耳机插拔广播（`ACTION_HEADSET_PLUG`）
**用途**：处理耳机插入/拔出事件（如音乐播放器暂停/恢复）。  
**注册方式**：  
- **动态注册**（仅支持此方式）：  
  ```java
  IntentFilter filter = new IntentFilter(Intent.ACTION_HEADSET_PLUG);
  registerReceiver(headsetReceiver, filter);
  ```  
  **数据获取**：  
  - 通过`intent.getIntExtra("state", 0)`判断状态（1=插入，0=拔出）。  


### 七、时区变化广播（`ACTION_TIMEZONE_CHANGED`）
**用途**：处理国际化时间相关的逻辑（如日历应用）。  
**注册方式**：  
1. **静态注册**：  
   ```xml
   <receiver android:name=".TimezoneReceiver">
       <intent-filter>
           <action android:name="android.intent.action.TIMEZONE_CHANGED" />
       </intent-filter>
   </receiver>
   ```  
2. **动态注册**（可选）：  
   ```java
   IntentFilter filter = new IntentFilter(Intent.ACTION_TIMEZONE_CHANGED);
   registerReceiver(timezoneReceiver, filter);
   ```  


### 八、短信接收广播（`ACTION_SMS_RECEIVED`）
**用途**：拦截或处理短信（如验证码自动填充）。  
**注册方式**：  
- **动态注册**（Android 8.0+推荐）：  
  ```java
  IntentFilter filter = new IntentFilter("android.provider.Telephony.SMS_RECEIVED");
  filter.setPriority(IntentFilter.SYSTEM_HIGH_PRIORITY); // 高优先级以优先接收
  registerReceiver(smsReceiver, filter);
  ```  
  **权限**：  
  - 需声明`RECEIVE_SMS`权限。  
  - Android 8.0+需动态注册以绕过隐式广播限制。  


### 关键注意事项
1. **权限与版本兼容**：  
   - 部分广播需特殊权限（如`RECEIVE_BOOT_COMPLETED`），必须在Manifest中声明。  
   - Android 8.0+严格限制隐式广播，静态注册前需确认广播是否在允许列表。  

2. **动态注册的生命周期**：  
   - 动态注册的接收器需在组件销毁前（如`onDestroy`）调用`unregisterReceiver`，避免内存泄漏。  

3. **后台限制**：  
   - Android 8.0+中，广播接收器的`onReceive`方法中禁止执行耗时操作，建议通过`Service`或`WorkManager`处理。  

4. **替代方案**：  
   - 对于Android 8.0+无法静态注册的广播（如开机广播），可使用`JobScheduler`或`WorkManager`实现定时任务。  

通过合理选择注册方式（静态或动态）并遵循系统限制，可高效监听系统广播并实现相应业务逻辑。