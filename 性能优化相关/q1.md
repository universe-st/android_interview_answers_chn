# 一张100x100的图片，在内存中的大小？

一张100x100像素的图片在内存中的大小取决于**像素数量、颜色格式、屏幕密度**以及**加载方式**。以下是基于Android平台的详细解析：

### 一、基础计算：像素数量与颜色格式
1. **像素数量**：  
   100×100像素的图片包含 **10,000个像素**。

2. **颜色格式决定单像素大小**：  
   - **ARGB_8888**（默认格式）：  
     每个像素包含Alpha（透明度）、Red、Green、Blue四个通道，每个通道8位，共 **4字节/像素**。  
     **内存大小 = 10,000 × 4 = 40,000字节（约39KB）**。  
   - **RGB_565**（无透明度）：  
     仅存储RGB通道，共16位（5+6+5），**2字节/像素**。  
     **内存大小 = 10,000 × 2 = 20,000字节（约19.5KB）**。  
   - **ALPHA_8**（仅有透明度）：  
     仅存储Alpha通道，**1字节/像素**。  
     **内存大小 = 10,000 × 1 = 10,000字节（约9.8KB）**。  
   - **其他格式**：  
     如ARGB_4444（2字节/像素，已弃用）或WebP/AVIF（解码后仍为位图，内存占用与颜色格式相关）。

### 二、屏幕密度缩放的影响
当图片存储在Android资源目录（如`drawable-hdpi`）中并通过`BitmapFactory.decodeResource`加载时，系统会根据设备屏幕密度自动缩放图片，导致内存占用增加。  
**示例**：  
- 设备为 **xxhdpi（480dpi）**，图片存放在`drawable-mdpi`（160dpi基准密度）中：  
  缩放比例 = 480 ÷ 160 = **3倍**，实际像素变为 **300×300**。  
  - ARGB_8888格式下：  
    **内存大小 = 300×300×4 = 360,000字节（约352KB）**。  
- 若图片存放在对应密度目录（如`drawable-xxhdpi`），则无需缩放，内存占用为原始计算值（40KB）。

### 三、加载方式的差异
1. **直接加载文件或资源**：  
   - 使用`BitmapFactory.decodeFile`加载本地图片或`decodeResource`加载资源目录图片时，若图片分辨率与设备密度不匹配，会自动缩放，导致内存占用增加。  
   - **优化方法**：  
     通过`BitmapFactory.Options`手动指定缩放比例（如`inSampleSize`）或目标尺寸，避免自动缩放。

2. **图片加载库的优化**：  
   - **Glide/Picasso**：  
     按ImageView实际尺寸加载图片，避免加载全尺寸图片。例如，若ImageView为100×100像素，库会自动缩放并缓存对应尺寸的图片，内存占用为 **40KB（ARGB_8888）或20KB（RGB_565）**。  
   - **内存格式优化**：  
     Glide默认使用RGB_565格式（需配置`override()`），进一步减少内存占用。

### 四、其他关键影响因素
1. **透明度（Alpha通道）**：  
   若图片包含透明区域（如PNG），使用ARGB_8888格式时，每个像素需额外存储Alpha通道，导致内存占用增加33%（从3字节到4字节）。

2. **硬件加速与缓存**：  
   - 启用硬件加速（`setLayerType(LAYER_TYPE_HARDWARE, null)`）可能增加额外内存开销（如纹理缓存）。  
   - 未及时回收Bitmap（`recycle()`）或内存泄漏会导致实际占用远超理论值。

3. **位深度与压缩格式**：  
   - 存储格式（如JPEG、PNG）仅影响文件大小，内存中解码后的位图大小由颜色格式决定。  
   - 高动态范围（HDR）图片可能使用更高位深度（如16位/通道），但Android平台默认仍为8位。

### 五、实际场景示例
1. **理想情况**：  
   - 图片存放在对应密度目录（如`drawable-xxhdpi`），使用RGB_565格式加载：  
     **内存占用 = 100×100×2 = 20KB**。

2. **典型问题场景**：  
   - 图片存放在`drawable-mdpi`，设备为xxhdpi：  
     **内存占用 = 300×300×4 = 352KB**（未优化时）。  
   - 优化后（使用Glide按ImageView尺寸加载）：  
     **内存占用 = 100×100×2 = 20KB**。

### 六、总结与优化建议
1. **理论最小值**：  
   - 无透明度、使用RGB_565格式：**19.5KB**。  
   - 有透明度、使用ARGB_8888格式：**39KB**。

2. **实际最大值**：  
   - 设备密度缩放+ARGB_8888格式：可达 **352KB**（如xxhdpi设备加载mdpi目录图片）。

3. **优化策略**：  
   - 使用图片加载库（Glide/Picasso）按实际尺寸加载。  
   - 优先使用RGB_565格式（`Bitmap.Config.RGB_565`），牺牲少量颜色精度换取内存节省。  
   - 避免将图片存放在通用密度目录（如`drawable`），按设备密度分目录存储。  
   - 及时回收不再使用的Bitmap（`recycle()`），并设置`inBitmap`复用内存。

通过合理选择颜色格式、优化加载方式和管理屏幕密度，可将100×100图片的内存占用控制在**20KB至40KB**之间，避免因不当处理导致内存飙升至数百KB。